<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>伪票根生成器</title>
    <style>
        * {margin: 0;padding: 0;box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;}
        body {background-color: #f8f9fa;color: #333;line-height: 1.6;padding: 20px;
            min-height: 100vh;}
        .container {max-width: 1000px;margin: 0 auto;background-color: white;
            border-radius: 12px;box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;}
        .header {background-color: #fff;padding: 24px 30px;
            border-bottom: 1px solid #eaeaea;}
        h1 {font-size: 28px;font-weight: 600;color: #1a1a1a;margin-bottom: 4px;}
        .subtitle {color: #666;font-size: 15px;}
        .content {display: flex;flex-wrap: wrap;padding: 0;}
        .controls {flex: 1;min-width: 350px;padding: 30px;border-right: 1px solid #eaeaea;}
        .preview-container {flex: 1;min-width: 300px;padding: 30px;background-color: #fafafa;}
        .control-group {margin-bottom: 28px;}
        .control-group h3 {font-size: 18px;font-weight: 600;margin-bottom: 16px;
            color: #2c2c2c;display: flex;align-items: center;}
        .control-group h3 i {margin-right: 10px;color: #4a6ee0;}
        .upload-area {display: flex;flex-direction: column;gap: 20px;}
        .upload-item {display: flex;flex-direction: column;}
        .upload-item label {font-size: 15px;font-weight: 600;margin-bottom: 10px;color: #444;}
        .upload-control {display: flex;align-items: center;gap: 12px;}
        .file-info {font-size: 15px;color: #555;background-color: #f5f7fa;
            padding: 10px 16px;border-radius: 8px;flex: 1;border: 1px solid #e0e6ed;
            min-height: 44px;display: flex;align-items: center;}
        .btn-upload {background-color: #4a6ee0;color: white;
            border: none;padding: 10px 20px;border-radius: 8px;
            cursor: pointer;font-size: 15px;font-weight: 500;transition: all 0.2s;
            display: flex;align-items: center;gap: 6px;}
        .btn-upload:hover {background-color: #3a5ed0;transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(74, 110, 224, 0.2);}
        .btn-upload:active {transform: translateY(0);}
        .edge-options {display: grid;grid-template-columns: 1fr 1fr;gap: 15px;}
        .edge-option {display: flex;align-items: center;gap: 10px;background-color: #f5f7fa;
            padding: 12px 16px;border-radius: 8px;border: 1px solid #e0e6ed;
            transition: all 0.2s;}
        .edge-option:hover {border-color: #4a6ee0;}
        .edge-option input[type="checkbox"] {width: 20px;height: 20px;cursor: pointer;
            accent-color: #4a6ee0;}
        .edge-option label {font-size: 15px;cursor: pointer;font-weight: 500;}
        .slider-container {display: flex;flex-direction: column;gap: 10px;}
        .slider-header {display: flex;justify-content: space-between;align-items: center;}
        .slider-header label {font-size: 15px;font-weight: 600;}
        .slider-value {font-size: 15px;font-weight: 600;color: #4a6ee0;
            background-color: rgba(74, 110, 224, 0.1);padding: 4px 12px;
            border-radius: 20px;}
        input[type="range"] {width: 100%;height: 6px;border-radius: 3px;
            background: #e0e6ed;outline: none;cursor: pointer;
            -webkit-appearance: none;}
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;width: 24px;height: 24px;border-radius: 50%;
            background: #4a6ee0;cursor: pointer;border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);}
        .divider-options {display: flex;gap: 20px;}
        .divider-option {display: flex;align-items: center;gap: 10px;
            background-color: #f5f7fa;padding: 12px 20px;border-radius: 8px;
            border: 1px solid #e0e6ed;transition: all 0.2s;}
        .divider-option:hover {border-color: #4a6ee0;}
        .divider-option input[type="radio"] {width: 20px;height: 20px;
            cursor: pointer;accent-color: #4a6ee0;}
        .divider-option label {font-size: 15px;cursor: pointer;font-weight: 500;}
        .preview-area {display: flex;flex-direction: column;height: 100%;}
        .preview-area h3 {font-size: 18px;font-weight: 600;margin-bottom: 20px;
            color: #2c2c2c;display: flex;align-items: center;}
        .preview-area h3 i {margin-right: 10px;color: #4a6ee0;}
        .ticket-preview-wrapper {flex: 1;display: flex;align-items: center;
            justify-content: center;}
        .ticket-preview {background-color: white;border-radius: 8px;border: 1px solid #ddd;
            position: relative;overflow: hidden;box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            width: 100%;padding-top: 33.33%; /* 1/3 = 33.33% 实现3:1长宽比 */
        }
        .ticket-left, .ticket-right {position: absolute;top: 0;height: 100%;}
        .ticket-left {left: 0;}
        .ticket-right {right: 0;}
        .divider {position: absolute;top: 0;bottom: 0;width: 0;border-left: 2px dashed #333;}
        .solid-divider {border-left-style: solid;}
        
        /* 圆形边缘样式 */
        .circle-edge {position: absolute;background-color: black;}
        .circle-top, .circle-bottom {left: 0;right: 0;height: 8px;}
        .circle-top {top: -4px;}
        .circle-bottom {bottom: -4px;}
        .dotted-left, .dotted-right {top: 0;bottom: 0;width: 8px;}
        .dotted-left {left: -4px;}
        .dotted-right {right: -4px;}
        .dot {position: absolute;width: 8px;height: 8px;background-color: black;border-radius: 50%;}
        .action-buttons {display: flex;gap: 16px;padding: 30px;border-top: 1px solid #eaeaea;
            background-color: #f9f9f9;}
        .btn-apply, .btn-save {flex: 1;border: none;padding: 16px 24px;border-radius: 8px;
            cursor: pointer;font-size: 16px;font-weight: 600;transition: all 0.2s;
            display: flex;align-items: center;justify-content: center;gap: 8px;}
        .btn-apply {background-color: #10b981;color: white;}
        .btn-apply:hover {background-color: #0da271;transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);}
        .btn-save {background-color: #3b82f6;color: white;}
        .btn-save:hover {background-color: #2563eb;transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);}
        .btn-apply:active, .btn-save:active {transform: translateY(0);}
        .image-placeholder {width: 100%;height: 100%;display: flex;flex-direction: column;
            align-items: center;justify-content: center;color: #999;font-size: 15px;}
        .image-placeholder i {font-size: 48px;margin-bottom: 12px;color: #ccc;}
        .uploaded-image {width: 100%;height: 100%;object-fit: cover;}
        .file-input {display: none;}
        .dimensions-info {font-size: 14px;color: #666;margin-top: 8px;display: flex;
            align-items: center;gap: 6px;}
        .dimensions-info i {color: #4a6ee0;}
        @media (max-width: 768px) {.content {flex-direction: column;}
            .controls {padding-right: 0;margin-bottom: 0;border-right: none;
                border-bottom: 1px solid #eaeaea;}
            .action-buttons {flex-direction: column;}
            .ticket-preview {padding-top: 33.33%;}
            .edge-options {grid-template-columns: 1fr;}}
        /* 上传文件样式 */
        .file-uploaded {background-color: #e8f5e9;border-color: #4caf50;}
        .file-name {font-weight: 500;}
        .file-size {font-size: 13px;color: #777;margin-left: 8px;}
        .upload-status {display: flex;align-items: center;gap: 8px;margin-top: 4px;}
        .upload-status i {color: #4caf50;}
        
        /* 完整圆形条样式 */
        .full-circle-bar {position: absolute;background-color: black;display: flex;
            justify-content: space-between;align-items: center;}
        .circle-bar-top, .circle-bar-bottom {left: 0;right: 0;height: 12px;}
        .circle-bar-top {top: -6px;}
        .circle-bar-bottom {bottom: -6px;}
        .circle-bar-circle {width: 12px;height: 12px;background-color: black;border-radius: 50%;}
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>票根生成器</h1>
            <p class="subtitle">上传图片，自定义票根样式，支持3:1长宽比和完整圆形条边缘</p>
        </div>
        <div class="content">
            <div class="controls">
                <div class="control-group">
                    <h3><i class="fas fa-upload"></i> 上传左侧图片</h3>
                    <div class="upload-area">
                        <div class="upload-item">
                            <div class="upload-control">
                                <div class="file-info" id="leftFileInfo">
                                    <div>未选择文件</div>
                                </div>
                                <button class="btn-upload" id="leftUploadBtn">
                                    <i class="fas fa-folder-open"></i> 选择文件
                                </button>
                                <input type="file" id="leftFileInput" class="file-input" accept="image/*">
                            </div>
                            <div class="upload-status" id="leftUploadStatus" style="display: none;">
                                <i class="fas fa-check-circle"></i>
                                <span>已上传</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="control-group">
                    <h3><i class="fas fa-upload"></i> 上传右侧图片</h3>
                    <div class="upload-area">
                        <div class="upload-item">
                            <div class="upload-control">
                                <div class="file-info" id="rightFileInfo">
                                    <div>未选择文件</div>
                                </div>
                                <button class="btn-upload" id="rightUploadBtn">
                                    <i class="fas fa-folder-open"></i> 选择文件
                                </button>
                                <input type="file" id="rightFileInput" class="file-input" accept="image/*">
                            </div>
                            <div class="upload-status" id="rightUploadStatus" style="display: none;">
                                <i class="fas fa-check-circle"></i>
                                <span>已上传</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="control-group">
                    <h3><i class="fas fa-cut"></i> 边缘设置</h3>
                    <p style="font-size: 14px; color: #666; margin-bottom: 15px;">上下边缘为完整圆形条，左右边缘为点状边缘</p>
                    <div class="edge-options">
                        <div class="edge-option">
                            <input type="checkbox" id="topCircleBar" checked>
                            <label for="topCircleBar">上边完整圆形条</label>
                        </div>
                        <div class="edge-option">
                            <input type="checkbox" id="bottomCircleBar" checked>
                            <label for="bottomCircleBar">下边完整圆形条</label>
                        </div>
                        <div class="edge-option">
                            <input type="checkbox" id="leftDotted" checked>
                            <label for="leftDotted">左边点状边缘</label>
                        </div>
                        <div class="edge-option">
                            <input type="checkbox" id="rightDotted" checked>
                            <label for="rightDotted">右边点状边缘</label>
                        </div>
                    </div>
                </div>
                <div class="control-group">
                    <h3><i class="fas fa-sliders-h"></i> 分割设置</h3>
                    <div class="slider-container">
                        <div class="slider-header">
                            <label for="splitRatio">分割比例:</label>
                            <span class="slider-value" id="splitValue">35%</span>
                        </div>
                        <input type="range" id="splitRatio" min="0" max="100" value="35">
                    </div>
                    <div style="margin-top: 24px;">
                        <h4 style="font-size: 15px; margin-bottom: 12px; color: #444;">分割线类型:</h4>
                        <div class="divider-options">
                            <div class="divider-option">
                                <input type="radio" id="dashedLine" name="dividerType" checked>
                                <label for="dashedLine">虚线</label>
                            </div>
                            <div class="divider-option">
                                <input type="radio" id="solidLine" name="dividerType">
                                <label for="solidLine">实线</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="dimensions-info">
                    <i class="fas fa-info-circle"></i>
                    <span>当前票根长宽比: 3:1 (宽:高)</span>
                </div>
            </div>
            <div class="preview-container">
                <div class="preview-area">
                    <h3><i class="fas fa-eye"></i> 预览区域</h3>
                    <div class="ticket-preview-wrapper">
                        <div class="ticket-preview" id="ticketPreview">
                            <!-- 左侧图片区域 -->
                            <div class="ticket-left" id="ticketLeft">
                                <div class="image-placeholder" id="leftPlaceholder">
                                    <i class="fas fa-image"></i>
                                    <span>左侧图片</span>
                                </div>
                                <img id="leftImage" class="uploaded-image" style="display: none;">
                            </div>
                            <!-- 右侧图片区域 -->
                            <div class="ticket-right" id="ticketRight">
                                <div class="image-placeholder" id="rightPlaceholder">
                                    <i class="fas fa-image"></i>
                                    <span>右侧图片</span>
                                </div>
                                <img id="rightImage" class="uploaded-image" style="display: none;">
                            </div>
                            <!-- 分割线 -->
                            <div class="divider" id="divider"></div>
                            <!-- 完整圆形条和点状边缘容器 -->
                            <div id="edgesContainer"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="action-buttons">
            <button class="btn-apply" id="applyBtn">
                <i class="fas fa-check"></i> 应用设置
            </button>
            <button class="btn-save" id="saveBtn">
                <i class="fas fa-download"></i> 保存图片
            </button>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const leftUploadBtn = document.getElementById('leftUploadBtn');
            const rightUploadBtn = document.getElementById('rightUploadBtn');
            const leftFileInput = document.getElementById('leftFileInput');
            const rightFileInput = document.getElementById('rightFileInput');
            const leftFileInfo = document.getElementById('leftFileInfo');
            const rightFileInfo = document.getElementById('rightFileInfo');
            const leftUploadStatus = document.getElementById('leftUploadStatus');
            const rightUploadStatus = document.getElementById('rightUploadStatus');
            const leftImage = document.getElementById('leftImage');
            const rightImage = document.getElementById('rightImage');
            const leftPlaceholder = document.getElementById('leftPlaceholder');
            const rightPlaceholder = document.getElementById('rightPlaceholder');
            const splitRatio = document.getElementById('splitRatio');
            const splitValue = document.getElementById('splitValue');
            const dashedLine = document.getElementById('dashedLine');
            const solidLine = document.getElementById('solidLine');
            const topCircleBar = document.getElementById('topCircleBar');
            const bottomCircleBar = document.getElementById('bottomCircleBar');
            const leftDotted = document.getElementById('leftDotted');
            const rightDotted = document.getElementById('rightDotted');
            const divider = document.getElementById('divider');
            const applyBtn = document.getElementById('applyBtn');
            const saveBtn = document.getElementById('saveBtn');
            const ticketLeft = document.getElementById('ticketLeft');
            const ticketRight = document.getElementById('ticketRight');
            const edgesContainer = document.getElementById('edgesContainer');
            
            // 图片数据
            let leftImageSrc = '';
            let rightImageSrc = '';
            let splitPercent = 35;
            
            // 初始化
            function init() {
                // 设置默认分割比例
                splitRatio.value = splitPercent;
                splitValue.textContent = splitPercent + '%';
                
                // 设置默认文件信息（模拟已上传左侧图片）
                leftFileInfo.innerHTML = `
                    <div>
                        <span class="file-name">上传图片就可以了.jpg</span>
                        <span class="file-size">(1.2MB)</span>
                    </div>
                `;
                leftFileInfo.classList.add('file-uploaded');
                leftUploadStatus.style.display = 'flex';
                
                // 设置默认图片
                leftImage.src = 'https://images.unsplash.com/photo-1579546929518-9e396f3cc809?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80';
                leftImage.style.display = 'block';
                leftPlaceholder.style.display = 'none';
                leftImageSrc = leftImage.src;
                
                // 更新预览
                updatePreview();
                
                // 设置事件监听
                setupEventListeners();}
            
            // 设置事件监听
            function setupEventListeners() {
                // 左侧上传按钮点击
                leftUploadBtn.addEventListener('click', () => leftFileInput.click());
                
                // 右侧上传按钮点击
                rightUploadBtn.addEventListener('click', () => rightFileInput.click());
                
                // 左侧文件选择变化
                leftFileInput.addEventListener('change', function(e) {
                    if (e.target.files.length) {handleFileSelect(e.target.files[0], 'left');}
                });
                
                // 右侧文件选择变化
                rightFileInput.addEventListener('change', function(e) {
                    if (e.target.files.length) {handleFileSelect(e.target.files[0], 'right');}
                });
                
                // 分割比例滑块变化
                splitRatio.addEventListener('input', function() {
                    splitPercent = parseInt(this.value);
                    splitValue.textContent = splitPercent + '%';
                    updatePreview();
                });
                
                // 分割线类型变化
                dashedLine.addEventListener('change', updatePreview);
                solidLine.addEventListener('change', updatePreview);
                
                // 边缘设置变化
                topCircleBar.addEventListener('change', updatePreview);
                bottomCircleBar.addEventListener('change', updatePreview);
                leftDotted.addEventListener('change', updatePreview);
                rightDotted.addEventListener('change', updatePreview);
                
                // 应用设置按钮点击
                applyBtn.addEventListener('click', applySettings);
                
                // 保存图片按钮点击
                saveBtn.addEventListener('click', saveImage);}
            
            // 处理文件选择
            function handleFileSelect(file, side) {
                if (!file.type.match('image.*')) {
                    alert('请选择图片文件！支持JPG、PNG格式');
                    return;}
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (side === 'left') {leftImageSrc = e.target.result;
                        leftImage.src = leftImageSrc;
                        leftImage.style.display = 'block';
                        leftPlaceholder.style.display = 'none';
                        
                        // 更新文件信息
                        leftFileInfo.innerHTML = `
                            <div>
                                <span class="file-name">${file.name}</span>
                                <span class="file-size">(${formatFileSize(file.size)})</span>
                            </div>
                        `;
                        leftFileInfo.classList.add('file-uploaded');
                        leftUploadStatus.style.display = 'flex';
                    } else {rightImageSrc = e.target.result;
                        rightImage.src = rightImageSrc;
                        rightImage.style.display = 'block';
                        rightPlaceholder.style.display = 'none';
                        
                        // 更新文件信息
                        rightFileInfo.innerHTML = `
                            <div>
                                <span class="file-name">${file.name}</span>
                                <span class="file-size">(${formatFileSize(file.size)})</span>
                            </div>
                        `;
                        rightFileInfo.classList.add('file-uploaded');
                        rightUploadStatus.style.display = 'flex';}
                    updatePreview();};
                reader.readAsDataURL(file);}
            
            // 格式化文件大小
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];}
            
            // 创建边缘
            function createEdges() {
                // 清空现有的边缘
                edgesContainer.innerHTML = '';
                const preview = document.getElementById('ticketPreview');
                const rect = preview.getBoundingClientRect();
                
                // 上边完整圆形条
                if (topCircleBar.checked) {
                    const topBar = document.createElement('div');
                    topBar.className = 'full-circle-bar circle-bar-top';
                    edgesContainer.appendChild(topBar);
                    
                    // 创建连续圆形条
                    const circleCount = Math.floor(rect.width / 12) + 1; // 圆形直径12px
                    for (let i = 0; i < circleCount; i++) {
                        const circle = document.createElement('div');
                        circle.className = 'circle-bar-circle';
                        circle.style.left = `${i * 12}px`;
                        topBar.appendChild(circle);}
                }
                
                // 下边完整圆形条
                if (bottomCircleBar.checked) {
                    const bottomBar = document.createElement('div');
                    bottomBar.className = 'full-circle-bar circle-bar-bottom';
                    edgesContainer.appendChild(bottomBar);
                    
                    // 创建连续圆形条
                    const circleCount = Math.floor(rect.width / 12) + 1; // 圆形直径12px
                    for (let i = 0; i < circleCount; i++) {
                        const circle = document.createElement('div');
                        circle.className = 'circle-bar-circle';
                        circle.style.left = `${i * 12}px`;
                        bottomBar.appendChild(circle);}
                }
                
                // 左边点状边缘
                if (leftDotted.checked) {
                    const dotsCount = Math.floor(rect.height / 8);
                    for (let i = 0; i < dotsCount; i++) {
                        const dot = document.createElement('div');
                        dot.className = 'dot';
                        dot.style.top = `${i * 8}px`;
                        dot.style.left = `-4px`;
                        edgesContainer.appendChild(dot);}
                }
                
                // 右边点状边缘
                if (rightDotted.checked) {
                    const dotsCount = Math.floor(rect.height / 8);
                    for (let i = 0; i < dotsCount; i++) {
                        const dot = document.createElement('div');
                        dot.className = 'dot';
                        dot.style.top = `${i * 8}px`;
                        dot.style.right = `-4px`;
                        edgesContainer.appendChild(dot);
                    }
                }
            }
            
            // 更新预览
            function updatePreview() {
                // 更新分割比例
                const leftWidth = splitPercent + '%';
                const rightWidth = (100 - splitPercent) + '%';
                ticketLeft.style.width = leftWidth;
                ticketRight.style.width = rightWidth;
                
                // 更新分割线位置
                divider.style.left = leftWidth;
                
                // 更新分割线样式
                if (solidLine.checked) {
                    divider.classList.add('solid-divider');
                } else {divider.classList.remove('solid-divider');}
                
                // 创建边缘
                createEdges();
            }
            
            // 应用设置
            function applySettings() {
                updatePreview();
                
                // 添加应用成功的视觉反馈
                const originalText = applyBtn.innerHTML;
                applyBtn.innerHTML = '<i class="fas fa-check"></i> 已应用';
                applyBtn.style.backgroundColor = '#0da271';
                setTimeout(() => {applyBtn.innerHTML = originalText;
                    applyBtn.style.backgroundColor = '#10b981';}, 1500);}
            
            // 保存图片
            function saveImage() {
                if (!leftImageSrc && !rightImageSrc) {alert('请至少上传一张图片！');
                    return;}
                
                // 创建临时canvas
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // 设置canvas尺寸为3:1比例
                const width = 900; // 设置固定宽度
                const height = Math.round(width / 3); // 3:1比例，高度是宽度的1/3
                canvas.width = width;
                canvas.height = height;
                
                // 绘制白色背景
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // 绘制左侧图片
                if (leftImageSrc) {const leftImg = new Image();
                    leftImg.onload = function() {
                        const leftWidth = canvas.width * splitPercent / 100;
                        ctx.save();ctx.beginPath();ctx.rect(0, 0, leftWidth, canvas.height);
                        ctx.clip();
                        
                        // 计算图片绘制参数使其填充整个区域
                        const scale = Math.max(leftWidth / leftImg.width, canvas.height / leftImg.height);
                        const scaledWidth = leftImg.width * scale;
                        const scaledHeight = leftImg.height * scale;
                        const x = (leftWidth - scaledWidth) / 2;
                        const y = (canvas.height - scaledHeight) / 2;
                        ctx.drawImage(leftImg, x, y, scaledWidth, scaledHeight);
                        ctx.restore();
                        
                        // 绘制右侧图片
                        if (rightImageSrc) {const rightImg = new Image();
                            rightImg.onload = function() {
                                const rightWidth = canvas.width - leftWidth;
                                ctx.save();
                                ctx.beginPath();
                                ctx.rect(leftWidth, 0, rightWidth, canvas.height);
                                ctx.clip();
                                
                                // 计算图片绘制参数使其填充整个区域
                                const scale = Math.max(rightWidth / rightImg.width, canvas.height / rightImg.height);
                                const scaledWidth = rightImg.width * scale;
                                const scaledHeight = rightImg.height * scale;
                                const x = leftWidth + (rightWidth - scaledWidth) / 2;
                                const y = (canvas.height - scaledHeight) / 2;
                                ctx.drawImage(rightImg, x, y, scaledWidth, scaledHeight);
                                ctx.restore();
                                
                                // 绘制边缘
                                drawEdges(ctx, canvas.width, canvas.height);
                                
                                // 绘制分割线
                                ctx.strokeStyle = '#333';
                                ctx.lineWidth = 2;
                                if (dashedLine.checked) {ctx.setLineDash([5, 5]);
                                } else {ctx.setLineDash([]);}
                                ctx.beginPath();
                                ctx.moveTo(leftWidth, 0);
                                ctx.lineTo(leftWidth, canvas.height);
                                ctx.stroke();
                                
                                // 创建下载链接
                                const link = document.createElement('a');
                                link.download = '票根设计-完整圆形条.png';
                                link.href = canvas.toDataURL('image/png');
                                link.click();
                                
                                // 添加保存成功的视觉反馈
                                const originalText = saveBtn.innerHTML;
                                saveBtn.innerHTML = '<i class="fas fa-check"></i> 已保存';
                                saveBtn.style.backgroundColor = '#1d4ed8';
                                setTimeout(() => {saveBtn.innerHTML = originalText;
                                    saveBtn.style.backgroundColor = '#3b82f6';}, 1500);};
                            rightImg.src = rightImageSrc;
                        } else {
                            // 只有左侧图片时
                            drawEdges(ctx, canvas.width, canvas.height);
                            
                            // 绘制分割线
                            ctx.strokeStyle = '#333';
                            ctx.lineWidth = 2;
                            if (dashedLine.checked) {ctx.setLineDash([5, 5]);
                            } else {ctx.setLineDash([]);}
                            ctx.beginPath();
                            ctx.moveTo(leftWidth, 0);
                            ctx.lineTo(leftWidth, canvas.height);
                            ctx.stroke();
                            
                            // 创建下载链接
                            const link = document.createElement('a');
                            link.download = '票根设计-完整圆形条.png';
                            link.href = canvas.toDataURL('image/png');
                            link.click();
                            
                            // 添加保存成功的视觉反馈
                            const originalText = saveBtn.innerHTML;
                            saveBtn.innerHTML = '<i class="fas fa-check"></i> 已保存';
                            saveBtn.style.backgroundColor = '#1d4ed8';
                            
                            setTimeout(() => {saveBtn.innerHTML = originalText;
                                saveBtn.style.backgroundColor = '#3b82f6';}, 1500);}};
                    leftImg.src = leftImageSrc;
                } else {
                    // 只有右侧图片时
                    const rightImg = new Image();
                    rightImg.onload = function() {
                        const leftWidth = canvas.width * splitPercent / 100;
                        const rightWidth = canvas.width - leftWidth;
                        ctx.save();
                        ctx.beginPath();
                        ctx.rect(leftWidth, 0, rightWidth, canvas.height);
                        ctx.clip();
                        
                        // 计算图片绘制参数使其填充整个区域
                        const scale = Math.max(rightWidth / rightImg.width, canvas.height / rightImg.height);
                        const scaledWidth = rightImg.width * scale;
                        const scaledHeight = rightImg.height * scale;
                        const x = leftWidth + (rightWidth - scaledWidth) / 2;
                        const y = (canvas.height - scaledHeight) / 2;
                        ctx.drawImage(rightImg, x, y, scaledWidth, scaledHeight);
                        ctx.restore();
                        
                        // 绘制边缘
                        drawEdges(ctx, canvas.width, canvas.height);
                        
                        // 绘制分割线
                        ctx.strokeStyle = '#333';
                        ctx.lineWidth = 2;
                        
                        if (dashedLine.checked) {ctx.setLineDash([5, 5]);
                        } else {ctx.setLineDash([]);}
                        ctx.beginPath();
                        ctx.moveTo(leftWidth, 0);
                        ctx.lineTo(leftWidth, canvas.height);
                        ctx.stroke();
                        
                        // 创建下载链接
                        const link = document.createElement('a');
                        link.download = '票根设计-完整圆形条.png';
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                        
                        // 添加保存成功的视觉反馈
                        const originalText = saveBtn.innerHTML;
                        saveBtn.innerHTML = '<i class="fas fa-check"></i> 已保存';
                        saveBtn.style.backgroundColor = '#1d4ed8';
                        setTimeout(() => {saveBtn.innerHTML = originalText;
                            saveBtn.style.backgroundColor = '#3b82f6';}, 1500);};
                    rightImg.src = rightImageSrc;}}
            
            // 绘制边缘
            function drawEdges(ctx, width, height) {
                const circleRadius = 6; // 圆形半径
                const dotRadius = 3; // 点状边缘半径
                
                // 上边完整圆形条
                if (topCircleBar.checked) {
                    const circleCount = Math.floor(width / (circleRadius * 2)) + 1;
                    for (let i = 0; i < circleCount; i++) {
                        const x = i * circleRadius * 2;
                        ctx.beginPath();
                        ctx.arc(x, 0, circleRadius, 0, Math.PI * 2);
                        ctx.fillStyle = 'black';
                        ctx.fill();}}
                
                // 下边完整圆形条
                if (bottomCircleBar.checked) {
                    const circleCount = Math.floor(width / (circleRadius * 2)) + 1;
                    for (let i = 0; i < circleCount; i++) {
                        const x = i * circleRadius * 2;
                        ctx.beginPath();
                        ctx.arc(x, height, circleRadius, 0, Math.PI * 2);
                        ctx.fillStyle = 'black';
                        ctx.fill();}}
                
                // 左边点状边缘
                if (leftDotted.checked) {
                    const dotsCount = Math.floor(height / 8);
                    for (let i = 0; i < dotsCount; i++) {
                        const y = i * 8;
                        ctx.beginPath();
                        ctx.arc(0, y, dotRadius, 0, Math.PI * 2);
                        ctx.fillStyle = 'black';
                        ctx.fill();}}
                
                // 右边点状边缘
                if (rightDotted.checked) {
                    const dotsCount = Math.floor(height / 8);
                    for (let i = 0; i < dotsCount; i++) {
                        const y = i * 8;
                        ctx.beginPath();
                        ctx.arc(width, y, dotRadius, 0, Math.PI * 2);
                        ctx.fillStyle = 'black';
                        ctx.fill();}}}
            
            // 初始化应用
            init();
        });
    </script>
</body>
</html>